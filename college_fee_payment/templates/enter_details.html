<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enter Payment Details â€“ PBR VITS</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <!-- No inline styles needed -->
</head>

<body>
    {% include 'spinner.html' %}
    <div class="container">

        <!-- PAYMENT PROGRESS -->
        <div class="card">
            <h3>Payment Progress</h3>
            <div class="progress">
                <div class="step done">
                    <div class="circle"></div>Select Payee
                </div>
                <div class="line"></div>
                <div class="step active">
                    <div class="circle"></div>Enter Payment Details
                </div>
                <div class="line"></div>
                <div class="step">
                    <div class="circle"></div>Verify Payment Details
                </div>
                <div class="line"></div>
                <div class="step">
                    <div class="circle"></div>Complete Payment
                </div>
                <div class="line"></div>
                <div class="step">
                    <div class="circle"></div>Print Receipt
                </div>
            </div>

            <div class="warning">
                <b>This page will expire in 01.00 minute, please complete the data entry in time to avoid timeout
                    error.</b>
            </div>
        </div>

        <!-- COLLEGE INFO -->
        <div class="card">
            <b>PBR VITS | VISVODAYA CAMPUS, UDAYAGIRI ROAD, KAVALI â€“ 524201</b>
        </div>

        <form action="{{ url_for('enter_details') }}" method="POST">
            <!-- STEP 1 : PAYMENT CATEGORY (NO CAPTCHA HERE) -->
            <div class="card" id="categorySection">
                <h3>Enter Payment Details</h3>

                <div class="form-row">
                    <label>Payment Category *</label>
                    <select id="paymentCategory" name="category" required>
                        <option value="">-- Select any Category --</option>
                        <option>EXAM FEE</option>
                        <option>PBRVITS COLLEGE FEE</option>
                        <option>MEN HOSTEL FEE</option>
                        <option>BUS FEE</option>
                        <option>WOMEN HOSTEL FEE</option>
                        <option>INTERNATIONAL CONFERENCE</option>
                        <option>VISVOTSAV EVENTS</option>
                    </select>
                </div>

                <button type="button" onclick="showDetails()">Proceed</button>
            </div>

            <!-- STEP 2 : FULL DETAILS -->
            <div class="card" id="detailsSection">
                <h3>Enter Payment Details</h3>

                <!-- Hidden input to store category for submission if the select above is hidden/disabled, 
                 but since it's in the same form, the select value will be sent. 
                 However, the JS below copies it to a text input. I'll make that text input readonly. -->

                <div class="form-row">
                    <label>Payment Category *</label>
                    <input type="text" id="selectedCategory" readonly>
                </div>

                <div class="form-row">
                    <label>Name of the Student *</label>
                    <input type="text" name="student_name" required>
                </div>

                <div class="form-row">
                    <label>Roll No *</label>
                    <input type="text" name="roll_no" required>
                </div>

                <div class="form-row">
                    <label>Academic Year *</label>
                    <select name="academic_year" required>
                        <option value="">-- Select Academic Year --</option>
                        <option>FIRST YEAR</option>
                        <option>SECOND YEAR</option>
                        <option>THIRD YEAR</option>
                        <option>FOURTH YEAR</option>
                    </select>
                </div>

                <div class="form-row">
                    <label>Semester *</label>
                    <select name="semester" required>
                        <option value="">-- Select Semester --</option>
                        <option>SEMESTER 1</option>
                        <option>SEMESTER 2</option>
                    </select>
                </div>

                <div class="form-row">
                    <label>Course *</label>
                    <select name="course" required>
                        <option value="">-- Select Course --</option>
                        <option>B.TECH</option>
                        <option>M.TECH</option>
                        <option>MCA</option>
                        <option>MBA</option>
                    </select>
                </div>

                <div class="form-row">
                    <label>Branch *</label>
                    <select name="branch" required>
                        <option value="">-- Select Branch --</option>
                        <option>CSE</option>
                        <option>CSE-AIML</option>
                        <option>CIVIL</option>
                        <option>ECE</option>
                        <option>IT</option>
                        <option>MECH</option>
                        <option>DSCE</option>
                        <option>VLSID</option>
                        <option>CS</option>
                        <option>MD</option>
                        <option>MBA</option>
                        <option>MCA</option>
                        <option>EEE</option>
                        <option>CSE-AI</option>
                        <option>CSE-IOT</option>
                    </select>
                </div>

                <div class="form-row">
                    <label>REGULATION *</label>
                    <select name="regulation" required>
                        <option value="">-- Select Regulation --</option>
                        <option>R09</option>
                        <option>R10</option>
                        <option>R11</option>
                        <option>R12</option>
                        <option>R13</option>
                        <option>R14</option>
                        <option>R15</option>
                        <option>R16</option>
                        <option>R17</option>
                        <option>R18</option>
                        <option>R19</option>
                        <option>R20</option>
                        <option>R21</option>
                        <option>R22</option>
                        <option>R23</option>
                        <option>R24</option>
                    </select>
                </div>

                <div class="form-row">
                    <label>FEE DETAILS *</label>
                    <select name="fee_details" required>
                        <option value="">-- Select Fee Details --</option>
                        <option>REGULAR</option>
                        <option>SUPPLY</option>
                        <option>RECOUNTING</option>
                        <option>PC</option>
                        <option>PROJECT</option>
                        <option>CONDONATION</option>
                    </select>
                </div>

                <div class="form-row">
                    <label>Amount *</label>
                    <input type="number" name="amount" required>
                </div>

                <div class="form-row">
                    <label>Remarks</label>
                    <textarea name="remarks"></textarea>
                </div>

                <h4>Enter Your Details</h4>

                <div class="form-row">
                    <label>Remitter Name *</label>
                    <input type="text" name="remitter_name" required>
                </div>

                <div class="form-row">
                    <label>Mobile No *</label>
                    <input type="text" name="mobile_no" placeholder="+91" required>
                </div>

                <div class="form-row">
                    <label>Email ID *</label>
                    <input type="email" name="email" required>
                </div>
            </div>

            <!-- TERMS, IMAGE + VOICE CAPTCHA & ACTION BUTTONS (LAST STEP) -->
            <div class="card captcha-section" id="captchaSection">

                <!-- TERMS -->
                <div class="terms-box">
                    <input type="checkbox" id="termsCheck" required>
                    <label for="termsCheck">
                        I have read and agreed to the
                        <a href="#">Terms &amp; Conditions</a>
                    </label>
                </div>

                <!-- CAPTCHA -->
                <div class="captcha-container">

                    <!-- LEFT -->
                    <div style="max-width: 350px;">
                        <label>
                            <b>Enter the text as shown in the image / heard in audio <span
                                    style="color:red">*</span></b>
                        </label>

                        <div class="captcha-row" id="imageCaptchaRow">
                            <div id="captchaBox" class="captcha-box"></div>
                            <button type="button" onclick="generateCaptcha()">â†»</button>
                        </div>

                        <div class="voice-controls" id="voiceControls" style="display:none;">
                            <button type="button" onclick="playVoiceCaptcha()">ðŸ”Š Play Captcha</button>
                        </div>

                        <input type="text" id="captchaInput" placeholder="Enter Captcha">
                    </div>

                    <!-- RIGHT -->
                    <div>
                        <label><b>Select Captcha type <span style="color:red">*</span></b></label>
                        <div class="captcha-type">
                            <input type="radio" name="captchaType" id="captchaImage" value="image" checked
                                onchange="switchCaptchaType()">
                            <label for="captchaImage">Image Captcha</label><br>

                            <input type="radio" name="captchaType" id="captchaVoice" value="voice"
                                onchange="switchCaptchaType()">
                            <label for="captchaVoice">Voice Captcha</label>
                        </div>
                    </div>

                </div>

                <!-- BUTTONS -->
                <div class="buttons">
                    <button type="button" onclick="goBack()">Back</button>
                    <button type="reset" onclick="resetForm()">Reset</button>
                    <button type="button" onclick="validateCaptcha()">Next</button>
                </div>

            </div>
        </form>

        <script>
            // navigation logic
            function showDetails() {
                const category = document.getElementById("paymentCategory").value;
                if (category === "") {
                    alert("Please select Payment Category");
                    return;
                }
                document.getElementById("categorySection").style.display = "none";
                document.getElementById("detailsSection").style.display = "block";
                // Populate the readonly input
                document.getElementById("selectedCategory").value = category;
            }


            function goBack() {
                // go back to category section
                document.getElementById("detailsSection").style.display = "none";
                document.getElementById("categorySection").style.display = "block";
            }

            function resetForm() {
                location.reload();
            }

            // captcha logic
            let captchaText = "";

            function generateCaptcha() {
                const chars = "abcdefghjkmnpqrstuvwxyz23456789";
                captchaText = "";
                for (let i = 0; i < 5; i++) {
                    captchaText += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                document.getElementById("captchaBox").innerText = captchaText;
            }

            function switchCaptchaType() {
                const isVoice = document.getElementById("captchaVoice").checked;
                const imageRow = document.getElementById("imageCaptchaRow");
                const voiceControls = document.getElementById("voiceControls");

                if (isVoice) {
                    imageRow.style.opacity = "0.3"; // show but de-emphasize
                    voiceControls.style.display = "block";
                } else {
                    imageRow.style.opacity = "1";
                    voiceControls.style.display = "none";
                }
            }

            function playVoiceCaptcha() {
                if (!captchaText) {
                    generateCaptcha();
                }
                const msg = new SpeechSynthesisUtterance();
                // read characters spaced out for clarity
                msg.text = captchaText.split("").join(" ");
                msg.lang = "en-IN";
                window.speechSynthesis.speak(msg);
            }

            function validateCaptcha() {
                const input = document.getElementById("captchaInput").value.trim();
                const terms = document.getElementById("termsCheck").checked;

                if (!terms) {
                    alert("Please agree to Terms & Conditions");
                    return;
                }

                if (input === "") {
                    alert("Please enter Captcha");
                    return;
                }

                if (input.toLowerCase() !== captchaText.toLowerCase()) {
                    alert("Invalid Captcha");
                    generateCaptcha();
                    return;
                }

                // Submit the form
                document.querySelector('form').submit();
            }

            // initialize captcha on load
            generateCaptcha();
        </script>

</body>

</html>